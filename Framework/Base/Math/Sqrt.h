///////////////////////////////////////////////////////////////////////////////////////
//  Sqrt.h
//
//  Square Root Function Calculation Methods Declarations
//  
//
///////////////////////////////////////////////////////////////////////////////////////

#ifndef _SQRT_H_
#define _SQRT_H_

M_FORCEINL float msqrt(float x);
///////////////////////////////////////////////////////////////////////////////////////
M_FORCEINL double msqrt(double x);

float m_tsqrt(float x);
///////////////////////////////////////////////////////////////////////////////////////
float m_rfsqrt(float x);
///////////////////////////////////////////////////////////////////////////////////////
float m_asqrt(float x);
///////////////////////////////////////////////////////////////////////////////////////
uint32t m_isqrt(uint32t x);
///////////////////////////////////////////////////////////////////////////////////////
uint64t m_isqrt(uint64t x);
///////////////////////////////////////////////////////////////////////////////////////
template <int bits>
tfixed32<bits> m_fxsqrt(tfixed32<bits> x);

///////////////////////////////////////////////////////////////////////////////////////
M_FORCEINL float msqrt(float x)
{
#ifdef CMATH_TABLE_SQRT
    return m_tsqrt(x);
#elif CMATH_FAST_SQRT
    return m_fsqrt(x);
#else
    return sqrtf(x);
#endif
}
///////////////////////////////////////////////////////////////////////////////////////
M_FORCEINL double msqrt(double x)
{
    return sqrt(x);
}

///////////////////////////////////////////////////////////////////////////////////////
template <int bits>
tfixed32<bits> m_fxsqrt(tfixed32<bits> val)
{
    tfixed32<bits> root(int32t(0));
    tfixed32<bits> temp, squaretemp;
    tfixed32<bits> bts(int32t(128));
    
    static const tfixed32<bits> one(int32t(1));
    
    if(val < one)
    {
        bts = one;
        bts >>= 1;
    }
    
    while(*((int32t*)bts))
    {
        temp = root | bts;
        
        if((squaretemp = temp*temp) <= val)
        {
            root = temp;

            if (squaretemp == val)
			{
				return root;
			}
        }

        bts >>= 1;
    }
    
    return root;
}

#endif //_SQRT_H_